Public WB As Workbook

Sub 选择文件()
    Dim varFileList As Variant
    Dim myResults As Variant
    Dim x As Integer
    Dim y As Integer
    x = 2
    y = 3
    Set WB = ActiveWorkbook
    
    ' 导入文件对话框
    Dim fd  As FileDialog
    Set fd = Application.FileDialog(msoFileDialogFilePicker)
    With fd
        .ButtonName = "打开"
        .Title = "选择数据文件"
        .AllowMultiSelect = True
        .Filters.Clear
        .Filters.Add "所有", "*.*"
        .Filters.Add "Nomad", "*.csv"
        .Filters.Add "SDR", "*.txt"
        .InitialView = msoFileDialogViewDetails
        .Show
    End With
    
    ' 载入文件数据
    For i = 1 To fd.SelectedItems.Count
        Dim fp As String
        fp = fd.SelectedItems(i)
        
        ' Call 显示首页
        ' Dim fs As Object, f As File
        ' Set fs = CreateObject("Scripting.FileSystemObject")
        ' Set f = fs.GetFile(fp)
        ' Cells(x + i - 1, y) = fp
        ' Cells(x + i - 1, y + 1) = f.Size
        
        ' 读取原始数据
        Dim SheetName As String
        SheetName = "raw" & CStr(i)

        Call 导入原始数据(fp, SheetName)

    Next i
End Sub

Sub 显示首页()
    x = ActiveSheet.name
    If x <> "main" Then Sheets("main").Select
End Sub

Sub 导入原始数据(path As String, SheetName As String)

    ' WB.Sheets.Add(After:=Worksheets(Worksheets.Count)).name = SheetName

    Workbooks.OpenText filename:=path, _
        Origin:=936, StartRow:=1, DataType:=xlDelimited, TextQualifier:= _
        xlDoubleQuote, ConsecutiveDelimiter:=False, Tab:=True, Semicolon:=False, _
        Comma:=True, Space:=False, Other:=False, TrailingMinusNumbers:=True

    Sheets(1).Select
    Sheets(1).name = SheetName
    Sheets(1).Move After:=WB.Sheets(WB.Sheets.Count)
    Sheets(SheetName).Select

    Call 显示首页
End Sub

